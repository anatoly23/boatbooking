<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Quick Start - Leaflet</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!--    <link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico"/>-->

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
        integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
        crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
        integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
        crossorigin=""></script>

    <style>
        body {
            padding: 0;
            margin: 0;
        }

        html,
        body,
        #map {
            height: 100%;
            width: 100%;
        }
    </style>
    <script type="text/javascript">


        async function ready() {
            let map = L.map('map').setView([59.938750, 30.252135], 13);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            const svgIcon = L.divIcon({
                html: `
        <svg
          width="48"
          height="80"
          viewBox="0 0 48 48"
          version="1.1"
          preserveAspectRatio="none"
          xmlns="http://www.w3.org/2000/svg"
        >
        <path d="M32.62 19.88s3-4.67 3.45-5a2.28 2.28 0 0 1 2.06.31c.35.3-.61 5.22-.61 5.22z" fill="#ff8a14" />
  <path d="M36.07 16.88a2.3 2.3 0 0 1 2 .25 4.74 4.74 0 0 0 .06-2 2.28 2.28 0 0 0-2.06-.31c-.48.35-3.45 5-3.45 5l1.22.13a28.06 28.06 0 0 1 2.23-3.07z" fill="#ffaa54" />
  <path fill="none" stroke="#45413c" stroke-linecap="round" stroke-linejoin="round" d="M32.62 19.88s3-4.67 3.45-5a2.28 2.28 0 0 1 2.06.31c.35.3-.61 5.22-.61 5.22z" />
  <ellipse cx="25.46" cy="32.92" rx="17.34" ry="1.58" fill="#45413c" opacity=".15" />
  <path d="M21.58 19.06a39.43 39.43 0 0 1 2.94-4.4 1 1 0 0 1 1.1-.34A51.86 51.86 0 0 1 34.45 18a10.73 10.73 0 0 1 1.42 2.14z" fill="#00b8f0" />
  <path d="M24.54 19.28l3.87.29 3.05-3.05c-.88-.39-1.89-.81-2.94-1.21z" fill="#4acfff" />
  <path fill="none" stroke="#45413c" stroke-linecap="round" stroke-linejoin="round" d="M21.58 19.06a39.43 39.43 0 0 1 2.94-4.4 1 1 0 0 1 1.1-.34A51.86 51.86 0 0 1 34.45 18a10.73 10.73 0 0 1 1.42 2.14z" />
  <path fill="none" stroke="#45413c" stroke-linecap="round" stroke-linejoin="round" d="M43.39 21.82v-5.06" />
  <path d="M43.39 12.67l3.55 1.56a.53.53 0 0 1 0 1l-3.55 1.57z" fill="#ff6242" stroke="#45413c" stroke-linecap="round" stroke-linejoin="round" />
  <path d="M3.42 19.67a1 1 0 0 0-.84 1.43c.94 2.36 3.46 7.51 8.05 9.57 5.4 2.43 28.95.86 33.87.5a1 1 0 0 0 1-1 17.9 17.9 0 0 0-.07-3.42 24.59 24.59 0 0 0-2-4.95s-6.57-2.56-21.81-2.76c-10.77-.12-16.02.35-18.2.63z" fill="#ffe500" />
  <path d="M44.46 27.82c-5.11.36-29.53 1.93-35.14-.5a15.57 15.57 0 0 1-6.81-6.5 1 1 0 0 0 .07.28c.94 2.36 3.46 7.51 8.05 9.57 5.4 2.43 28.95.86 33.87.5a1 1 0 0 0 1-1 19.74 19.74 0 0 0 0-3.16 1.07 1.07 0 0 1-1.04.81z" fill="#ebcb00" />
  <path fill="none" stroke="#45413c" stroke-linecap="round" stroke-linejoin="round" d="M3.42 19.67a1 1 0 0 0-.84 1.43c.94 2.36 3.46 7.51 8.05 9.57 5.4 2.43 28.95.86 33.87.5a1 1 0 0 0 1-1 17.9 17.9 0 0 0-.07-3.42 24.59 24.59 0 0 0-2-4.95s-6.57-2.56-21.81-2.76c-10.77-.12-16.02.35-18.2.63z" />
  <path d="M45.19 25.92a23.21 23.21 0 0 0-.91-2.26 144.45 144.45 0 0 0-15-1.31c-12.22-.59-26.45-.53-26.45-.53a22.75 22.75 0 0 0 1.05 2.1c3.49 0 15.15 0 25.4.53a127.56 127.56 0 0 1 15.91 1.47z" fill="#fff" stroke="#45413c" stroke-linecap="round" stroke-linejoin="round" />
        </svg>`,
                className: "",
                iconSize: [48, 80],
                iconAnchor: [24, 80],
            });

            webSocket = new WebSocket("ws://localhost:8000/ws/wscoords");

            let boats = {}

            webSocket.onmessage = function (event) {

                var coords = JSON.parse(event.data);

                if (boats[coords.boat_id]) {
                    boats[coords.boat_id].setLatLng([coords.latitude, coords.longitude])
                }
                else {
                    boats[coords.boat_id] = L.marker([coords.latitude, coords.longitude], { icon: svgIcon }).addTo(map)
                }

            }

        }

        document.addEventListener("DOMContentLoaded", ready)
    </script>

</head>

<body>
    <div id="map"></div>

</body>

</html>